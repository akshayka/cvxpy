
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TODO &#8212; CVXPY 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/cvxpy_alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="todo">
<h1>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>time-varying graphs</li>
<li>table of results</li>
<li>show combinatorics. why not NP hard. enumerate paths.</li>
<li>remove <span class="math">\(\mathcal{P}\)</span>. just describe a path with <span class="math">\(x\)</span> from
the start?</li>
</ul>
</div>
<div class="section" id="topic-references">
<h1>Topic references<a class="headerlink" href="#topic-references" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/">Convex Optimization book</a></li>
<li><a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/bv_cvxbook_extra_exercises.pdf">Additional Exercise 15.4: Allocation of interdiction
effort</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Shortest_path_problem">Shortest path problem in graph
theory</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a></li>
<li><cite>Iterated weighted :math:</cite>ell_1`
heuristic &lt;<a class="reference external" href="http://stanford.edu/class/ee364b/lectures/l1_ext_slides.pdf">http://stanford.edu/class/ee364b/lectures/l1_ext_slides.pdf</a>&gt;`__</li>
</ul>
</div>
<div class="section" id="allocating-interdiction-effort-to-catch-a-smuggler">
<h1>Allocating interdiction effort to catch a smuggler<a class="headerlink" href="#allocating-interdiction-effort-to-catch-a-smuggler" title="Permalink to this headline">¶</a></h1>
<p>We’ll explore a game between a smuggler moving through a graph and a
security team trying to catch him.</p>
<p>The smuggler moves along a directed graph (cycles are allowed) with
<span class="math">\(n\)</span> nodes and <span class="math">\(m\)</span> edges from node <span class="math">\(0\)</span> (the source) to
node <span class="math">\(n-1\)</span> (the destination). Edge <span class="math">\(j\)</span> has evasion
probability <span class="math">\(p_j\)</span>, which is the probability that the smuggler
moves along that edge undetected. The detection events on the edges are
independent, so the probability that the smuggler makes it to the
destination undetected is <span class="math">\(\prod_{j \in \mathcal{P}} p_j\)</span>, where
<span class="math">\(\mathcal{P} \subset \lbrace 0,\ldots, m-1\rbrace\)</span> is the set of
edges on the smuggler’s path. We assume that the smuggler knows the
evasion probabilities and will take a path that maximizes the
probability of making it to the destination node undetected.</p>
<p>The security team is trying to catch the smuggler as he moves through
the graph. They can control the evasion probabilities on the graph edges
through, say, allocation of resources to the edges, assigning guards,
etc. We’ll keep this abstract for now, and just consider that security
can modify the evasion probabilities subject to some constraints. Their
goal is to choose evasion probabilities to minimize the chance that the
smuggler gets through undetected.</p>
</div>
<div class="section" id="transformations-and-mathematical-formulation">
<h1>Transformations and mathematical formulation<a class="headerlink" href="#transformations-and-mathematical-formulation" title="Permalink to this headline">¶</a></h1>
<p>We’ll take the logarithm of all probabilities to make the problem
amenable to convex optimization and simplify the remaining discussion.
This transforms products of variables (generally not convex) into sums
of variables (convex!).</p>
<p>Let <span class="math">\(c_j = \log(p_j)\)</span>. As this is a one-to-one correspondence, we
may refer to the ‘edge detection probabilities’ when we really mean to
refer to their logarithm, <span class="math">\(c\)</span>. This should be clear from context
and hopefully won’t cause any confusion.</p>
<p>Given <span class="math">\(c\)</span> and a path <span class="math">\(\mathcal{P}\)</span>, let
<span class="math">\(P(c, \mathcal{P})\)</span> be the logarithm of the evasion probability of
that path. That is,</p>
<div class="math">
\[P(c, \mathcal{P}) = \log \left( \prod_{j \in \mathcal{P}} p_j \right) = \sum_{j \in \mathcal{P}} \log(p_j) = \sum_{j \in \mathcal{P}} c_j.\]</div>
<p>Define <span class="math">\(P(c, \mathcal{P}) = -\infty\)</span> if <span class="math">\(\mathcal{P}\)</span> is not
a valid path from source to sink. We do this to implicity encode the
constraint that the smuggler’s path must be valid.</p>
</div>
<div class="section" id="min-max-game">
<h1>Min/max game<a class="headerlink" href="#min-max-game" title="Permalink to this headline">¶</a></h1>
<p>We can now interpret this problem as a min/max game. The smuggler is
trying to maximize his chance of getting through undetected by choosing
<span class="math">\(\mathcal{P}\)</span>, and security is trying to minimize the smuggler’s
chance by choosing <span class="math">\(c\)</span>. That is, the smuggler is trying to
maximize <span class="math">\(P(c, \mathcal{P})\)</span> while the security team is trying to
minimize it.</p>
<p>We end up with a game with two ‘moves’. Security ‘moves’ first by
choosing the edge evasion probabilities via <span class="math">\(c\)</span>. The smuggler
‘moves’ second (after <span class="math">\(c\)</span> is fixed) by choosing his path
<span class="math">\(\mathcal{P}\)</span>.</p>
<p>For security to make an optimal choice of edge evasion probabilities,
they’ll need to model what the smuggler will do when faced with any set
of evasion probabilities. Thus, we’ll let <span class="math">\(P^\mathrm{opt}(c)\)</span> be
the optimal value of the problem</p>
<p>\[ ]</p>
<p><span class="math">\(P^\mathrm{opt}(c)\)</span> is the (logarithm of the) evasion probability
of the smuggler if he picks an optimal path, knowing the values of
<span class="math">\(c\)</span>.</p>
<p>The security team’s goal is then to minimize this quantity, subject to
some constraints on <span class="math">\(c\)</span>, which we’ll denote by the set
<span class="math">\(\mathcal{C}\)</span>. Let <span class="math">\(P^{\star}\)</span> be the optimal value of</p>
<p>\[ ]</p>
<p>In the remainder, we’ll first consider the smuggler’s objective so as to
obtain a convex formulation of <span class="math">\(P^\mathrm{opt}(c)\)</span>, which we can
then use to analyze and optimize the security team’s objective.</p>
</div>
<div class="section" id="helper-functions">
<h1>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h1>
<p>The next cell contains some helper functions for generating the examples
and plotting the results. This is the majority of the code. The actual
CVXPY optimization code is only a few lines. We’ll go over the
optimization code later in the notebook.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="c1">#%config InlineBackend.figure_format = &#39;pdf&#39;</span>
<span class="c1">#%config InlineBackend.figure_format = &#39;svg&#39;</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">cvxpy</span> <span class="k">as</span> <span class="nn">cvx</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Form N by N grid of nodes, perturb by mu and connect nodes within eta.</span>
<span class="sd">        mu and eta are relative to 1/(N-1)</span>

<span class="sd">        buildings is a list of tuples (x,y,w,h)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># generate perterbed grid positions for the nodes</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span> <span class="n">j</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">())</span>\
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)]</span>

    <span class="c1">#select out nodes that end up inside buildings</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">buildings</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">pos2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">inside</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inside</span><span class="p">:</span>
                <span class="n">pos2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos2</span>

    <span class="c1"># add dummy nodes for multiple entry/exit example</span>
    <span class="k">if</span> <span class="n">dummyNodes</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)]</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">1.5</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)]</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="c1"># connect nodes with edges</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">random_geometric_graph</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span>

    <span class="c1"># remove edges that cross buildings</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">buildings</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
            <span class="n">blocked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">intersect</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
                    <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">blocked</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="c1"># add edges connecting dummy nodes to nodes on left and right edges of grid</span>
    <span class="k">if</span> <span class="n">dummyNodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">pos</span>

<span class="k">def</span> <span class="nf">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Takes directed graph G, node positions pos, and edge probabilities.</span>
<span class="sd">        Optionally uses path (a list of edge indices) to plot the smuggler&#39;s path.</span>

<span class="sd">        edgeProbd gives the probabilities for all the edges, including hidden ones.</span>

<span class="sd">        path includes all the edges, including the hidden ones</span>

<span class="sd">        Gnodes and Rnodes denote the source and destination nodes, to be plotted green</span>
<span class="sd">        and red respectively.</span>

<span class="sd">        guards is a list of node indices for denoting guards with a black dot on the plot</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">visibleNodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visibleNodes</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

    <span class="c1"># draw the regular interior nodes in the graph</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># draw the origin and destination nodes</span>
    <span class="k">for</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">color2</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">color</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
                           <span class="n">node_color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># draw guard nodes</span>
    <span class="k">if</span> <span class="n">guards</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">guards</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;.0&#39;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span>

    <span class="c1"># start messing with edges</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">ind2edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">e</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>

    <span class="c1"># only display edges between non-dummy nodes</span>
    <span class="n">visibleEdges</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2ind</span><span class="p">))</span> <span class="k">if</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span> <span class="ow">and</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span><span class="p">]</span>

    <span class="n">edgelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visibleEdges</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
        <span class="n">edgeProbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">]</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visibleEdges</span><span class="p">]</span>

    <span class="c1"># draw edges of graph, make transparent if we&#39;re drawing a path over them</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                   <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">,</span><span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span><span class="n">edge_vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                   <span class="n">edge_vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># draw the path, only between visible nodes</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visiblePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span> <span class="k">if</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span> <span class="ow">and</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span><span class="p">]</span>
        <span class="n">path_pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visiblePath</span><span class="p">]</span>
        <span class="n">path_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visiblePath</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="n">path_colors</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                       <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">path_pairs</span><span class="p">,</span><span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edge_vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                   <span class="n">edge_vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Evasion probability&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">])</span>
    <span class="c1">#ax.axis(&#39;tight&#39;)</span>
    <span class="c1">#ax.axis(&#39;equal&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

<span class="k">def</span> <span class="nf">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Find the optimal smuggler&#39;s path in directed graph G</span>
<span class="sd">        with edge evasion probabilities p and dictionary</span>
<span class="sd">        edge2ind bringing node pairs to edge indices</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">H</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]]</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#path = nx.astar_path(H,0,n-1,weight=&#39;w&#39;)</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="n">foo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;determine if a rectangle given by xy limits blocks the line of sight between p1 and p2&#39;&#39;&#39;</span>

    <span class="n">block</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># if either point inside block</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span><span class="n">p1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">xmax</span> <span class="ow">and</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># if the two points are equal at this stage, then they are outside the block</span>
    <span class="k">if</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>


    <span class="k">if</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; for n guards and m edges, return an m by n matrix giving the</span>
<span class="sd">        effect of each guard on the evasion probabilities of each edge</span>
<span class="sd">        in the graph.</span>

<span class="sd">        Ignore dummy nodes, if any. Guards cannot see through buildings.</span>

<span class="sd">        guardIdxs is a list of the node indices where we would consider placing</span>
<span class="sd">        guards</span>

<span class="sd">        Return the log of the detection probabilities for each guard.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">evadeProb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">radius</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">radius</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="o">+.</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">buildings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dummyNodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dummyNodes</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="n">ind2edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">e</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">edgeCenters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">edgeCenters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">edgeCenters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edgeCenters</span><span class="p">)</span>
    <span class="n">numGuards</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">)</span>
    <span class="n">edgeVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">numGuards</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">blocked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">intersect</span><span class="p">(</span><span class="n">edgeCenters</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="n">pos</span><span class="p">[</span><span class="n">gid</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
                    <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummyNodes</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummyNodes</span><span class="p">:</span>
                <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blocked</span><span class="p">:</span>
                <span class="n">edgeVals</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">evadeProb</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">-</span><span class="n">edgeCenters</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="o">.</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">edgeVals</span>

<span class="k">def</span> <span class="nf">get_a</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate a random value in [0,1] for each edge in the graph.</span>
<span class="sd">    For directed graphs, directed edges between the same nodes should have the same value</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">))</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">edge2ind</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</div>
<div class="section" id="smuggler-s-objective">
<h1>Smuggler’s objective<a class="headerlink" href="#smuggler-s-objective" title="Permalink to this headline">¶</a></h1>
<p>The smuggler chooses a path <span class="math">\(\mathcal{P}\)</span> only after <span class="math">\(c\)</span> is
fixed. His goal is to find a valid path in the graph which maximizes
<span class="math">\(\sum_{j \in \mathcal{P}} c_j\)</span>. Note that this problem can be cast
and solved exactly as a <a class="reference external" href="http://en.wikipedia.org/wiki/Shortest_path_problem">shortest path problem in graph
theory</a>. We
formulate it here as a convex problem so that the security team can use
the model to thwart the smuggler.</p>
<p>We’ll denote possible paths with a Boolean decision variable
<span class="math">\(x \in \lbrace 0,1 \rbrace^m\)</span>, where <span class="math">\(x_j = 1\)</span> denotes
<span class="math">\(j \in \mathcal{P}\)</span>. Note that this allows us to write the
smuggler’s objective as</p>
<div class="math">
\[\sum_{j \in \mathcal{P}} c_j = \sum_{j=0}^{n-1} c_j x_j = c^T x.\]</div>
<p>The <span class="math">\(x\)</span> variable needs to satisfy certain constraints to represent
a valid path. Firstly, the number of times the path exits the source
node must be exactly one more than the number of times it enters the
source node. Similarly, the number of times the path enters the
destination node must be exactly one more than the number of times it
exits destination node. For all other nodes in the graph, the number of
times the path enters and exits the node must be equal. These
constraints can be represented as <span class="math">\(Ax = b\)</span>, where</p>
<p>\[ b_i = ]</p>
<p>\[ A_{ij} = ]</p>
<p>The smuggler’s problem can then be written so that
<span class="math">\(P^\mathrm{opt}(c)\)</span> is the optimum value of the problem</p>
<p>\[ ]</p>
<p>This is a linear problem with Boolean variables, which is not convex,
but we can transform it into a convex problem by relaxing the Boolean
constraints to get the linear program</p>
<p>\[ ] with optimum value <span class="math">\(P^{\mathrm{opt}}_\mathrm{R}(c)\)</span>.</p>
<p>It turns out that this relaxed convex problem solves the original
Boolean problem <em>exactly</em>. That is,
<span class="math">\(P^{\mathrm{opt}}(c) = P^{\mathrm{opt}}_\mathrm{R}(c)\)</span>, so we will
only write <span class="math">\(P^{\mathrm{opt}}\)</span> in the remainder. In addition, the
solution to the LP, <span class="math">\(x^\star\)</span>, will be Boolean when there is a
unique optimal path. In the presence of multiple optimal paths, the
<span class="math">\(x^\star\)</span> may have fractional entries, but an optimal path can
still be recovered.</p>
<p>For the purposes of the security team, we’ll only need that the Boolean
and LP optimal values are equal. Before continuing on to security’s
perspective, we’ll look at an example of the smuggler choosing an
optimal path in a given graph.</p>
</div>
<div class="section" id="smuggler-s-path-example">
<h1>Smuggler’s path example<a class="headerlink" href="#smuggler-s-path-example" title="Permalink to this headline">¶</a></h1>
<p>We’ll solve the smuggler’s problem on an example network to see an
example of an optimal path.</p>
<p>We’ll create an <span class="math">\(N \times N\)</span> grid of points with small
perturbations to make the graph irregular, connecting two nodes with two
directed edges (one going each way) if the nodes are within distance
<span class="math">\(\eta\)</span> of each other. Pairs of edges <span class="math">\((i,j)\)</span> and
<span class="math">\((j,i)\)</span> will have identical evasion probabilities, i.e., the
evasion probability is the same in either direction between two
connected nodes. The evasion probability will be distributed like
<span class="math">\(p_j = e^{-a_j}\)</span>, where <span class="math">\(a_j\)</span> is a uniform random variable
over the interval <span class="math">\(\left[0,1\right]\)</span>.</p>
<p>The smuggler will find an optimal path from node <span class="math">\(0\)</span> in the
upper-left corner of the graph plot to node <span class="math">\(n-1\)</span> in the
lower-right corner of the graph plot.</p>
<p>We show the graph with the edge evasion probabilities below.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">.</span><span class="mi">12</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">get_a</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_5_0.png"><img alt="../../_images/interdiction_5_0.png" src="../../_images/interdiction_5_0.png" style="width: 463px; height: 376px;" /></a>
<p>We form the smuggler’s relaxed convex problem and solve it to find his
optimal path. We plot the path below.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">incidence_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">oriented</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges_iter</span><span class="p">())}</span>

<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">,</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">,</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cvx</span><span class="o">.</span><span class="n">Maximize</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">c</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ECOS</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">A</span><span class="o">.</span> <span class="n">Domahidi</span><span class="p">,</span> <span class="n">Automatic</span> <span class="n">Control</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">ETH</span> <span class="n">Zurich</span><span class="p">,</span> <span class="mi">2012</span><span class="o">-</span><span class="mf">2014.</span>

<span class="n">It</span>     <span class="n">pcost</span>         <span class="n">dcost</span>      <span class="n">gap</span>     <span class="n">pres</span>    <span class="n">dres</span>     <span class="n">k</span><span class="o">/</span><span class="n">t</span>     <span class="n">mu</span>      <span class="n">step</span>     <span class="n">IR</span>
 <span class="mi">0</span>   <span class="o">+</span><span class="mf">8.219e+01</span>   <span class="o">-</span><span class="mf">4.479e+02</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>    <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span>
 <span class="mi">1</span>   <span class="o">+</span><span class="mf">5.388e+01</span>   <span class="o">-</span><span class="mf">3.725e+01</span>   <span class="o">+</span><span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.8500</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">2</span>   <span class="o">+</span><span class="mf">1.745e+01</span>   <span class="o">-</span><span class="mf">8.925e+00</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.7788</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">3</span>   <span class="o">+</span><span class="mf">9.313e+00</span>   <span class="o">+</span><span class="mf">4.727e-01</span>   <span class="o">+</span><span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.6993</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">4</span>   <span class="o">+</span><span class="mf">5.212e+00</span>   <span class="o">+</span><span class="mf">4.172e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.9673</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">5</span>   <span class="o">+</span><span class="mf">4.788e+00</span>   <span class="o">+</span><span class="mf">4.650e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.8829</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">6</span>   <span class="o">+</span><span class="mf">4.723e+00</span>   <span class="o">+</span><span class="mf">4.717e+00</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mf">0.9750</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">7</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mf">0.9899</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">8</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mf">0.9899</span>   <span class="mi">3</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">9</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mf">4.720e+00</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">12</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mf">0.9899</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>

<span class="n">OPTIMAL</span> <span class="p">(</span><span class="n">within</span> <span class="n">feastol</span><span class="o">=</span><span class="mf">3.3e-12</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">1.5e-09</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">7.1e-09</span><span class="p">)</span><span class="o">.</span>
<span class="n">Runtime</span><span class="p">:</span> <span class="mf">0.004822</span> <span class="n">seconds</span><span class="o">.</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">, or </span><span class="si">%.3f%%</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 8.913907e-03, or 0.891%.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_8_1.png"><img alt="../../_images/interdiction_8_1.png" src="../../_images/interdiction_8_1.png" style="width: 463px; height: 376px;" /></a>
<p>We run a discrete graph-theoretic shortest path algorithm on the same
graph to check that we get the same optimal path. The function
<code class="docutils literal"><span class="pre">optPath</span></code> is using the NetworkX Python package and
<a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a>
to compute the optimal path.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">, or </span><span class="si">%.3f%%</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 8.913907e-03, or 0.891%.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_10_1.png"><img alt="../../_images/interdiction_10_1.png" src="../../_images/interdiction_10_1.png" style="width: 463px; height: 376px;" /></a>
</div>
<div class="section" id="security-s-objective">
<h1>Security’s objective<a class="headerlink" href="#security-s-objective" title="Permalink to this headline">¶</a></h1>
<p>The security team’s goal is to minimize <span class="math">\(P^\mathrm{opt}(c)\)</span>,
subject to some constraints (say, limits on budget or personnel), which
we’ll denote by <span class="math">\(c \in \mathcal{C}\)</span>:</p>
<p>\[ ]</p>
<p>But note that <span class="math">\(P^{\mathrm{opt}}(c)\)</span> is the optimal value of the
problem</p>
<p>\[ ]</p>
<p>We’d like to combine these two optimization problems into a single
problem for the security team to solve, but this is problematic as the
variables of one problem, <span class="math">\(x\)</span>, are multiplied with the variables
of the other, <span class="math">\(c\)</span>, which is not a convex objective in general. To
get around this, we’ll take the dual (Chapter 5 of the <a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/">Convex
Optimization book</a>) of the
smuggler’s problem.</p>
<p>Let <span class="math">\(D^\mathrm{opt}(c)\)</span> denote the optimal value of the dual of
the smuggler’s problem, which is</p>
<p>\[ ] with dual variable <span class="math">\(\lambda\)</span>.</p>
<p>Duality theory guarantees that
<span class="math">\(D^\mathrm{opt}(c) = P^{\mathrm{opt}}(c)\)</span>, which allows us to
write the security team’s problem as</p>
<p>\[ ] which we can rewrite as the single optimization problem</p>
<p>\[ ] where <span class="math">\(c\)</span> and <span class="math">\(\lambda\)</span> are the optimization
variables.</p>
<p>We will denote the optimal value of this problem as <span class="math">\(P^\star\)</span>. By
solving to find <span class="math">\(c^\star\)</span>, the security team will have optimally
allocated resources to make detection of the smuggler as likely as
possible.</p>
</div>
<div class="section" id="security-example">
<h1>Security example<a class="headerlink" href="#security-example" title="Permalink to this headline">¶</a></h1>
<p>We’ll consider security’s problem on the same network as the last
example with the edge evasion probabilities modeled as
<span class="math">\(p_j = e^{-a_j r_j}\)</span>, where <span class="math">\(r_j \in \mathbf{R}_+\)</span> denotes
the effort (say, yearly budget) allocated to edge <span class="math">\(j\)</span>. We’ll
assume <span class="math">\(a_j \in \mathbf{R}_{++}\)</span> are given and represent the cost
involved in securing an edge. As in the last example, <span class="math">\(a_j\)</span> is a
uniform random variable over the interval <span class="math">\(\left[0,1\right]\)</span>.</p>
<p>We’ll use the same random seed as the last example, so the last example
corresponds to the specific allocation <span class="math">\(r_j = 1\)</span> for all <span class="math">\(j\)</span>
in the current model. We’ll use this to compare the detection
probability of a naive, uniform effort allocation against the optimal
allocation.</p>
<p>For this example, we’ll impose a maximum budget constraint
<span class="math">\(\sum_{j=0}^{m-1} r_j = m\)</span>, and a uniform spending limit on each
edge, <span class="math">\(r_j \leq R\)</span>.</p>
<p>We’ll also constrain that the evasion probability is equal in both
directions. That is, edge <span class="math">\((i,j)\)</span> and edge <span class="math">\((j,i)\)</span> have
equal evasion probabilities. We’ll enforce that constraint with
<span class="math">\(Br = 0\)</span>, for some matrix <span class="math">\(B\)</span>.</p>
<p>The final model is \[ ]</p>
<p>We solve the model below with <span class="math">\(R=5\)</span> and report the evasion
probability of the smuggler’s optimal path.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">nu</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">nu</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">cvx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="n">cvx</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="o">*</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cvx</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ECOS</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">A</span><span class="o">.</span> <span class="n">Domahidi</span><span class="p">,</span> <span class="n">Automatic</span> <span class="n">Control</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">ETH</span> <span class="n">Zurich</span><span class="p">,</span> <span class="mi">2012</span><span class="o">-</span><span class="mf">2014.</span>

<span class="n">It</span>     <span class="n">pcost</span>         <span class="n">dcost</span>      <span class="n">gap</span>     <span class="n">pres</span>    <span class="n">dres</span>     <span class="n">k</span><span class="o">/</span><span class="n">t</span>     <span class="n">mu</span>      <span class="n">step</span>     <span class="n">IR</span>
 <span class="mi">0</span>   <span class="o">+</span><span class="mf">8.656e-17</span>   <span class="o">-</span><span class="mf">2.680e+03</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>    <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span>
 <span class="mi">1</span>   <span class="o">-</span><span class="mf">1.558e+00</span>   <span class="o">-</span><span class="mf">4.454e+02</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.8475</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">2</span>   <span class="o">-</span><span class="mf">5.901e+00</span>   <span class="o">-</span><span class="mf">1.399e+02</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.8810</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">3</span>   <span class="o">-</span><span class="mf">9.799e+00</span>   <span class="o">-</span><span class="mf">8.402e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.5281</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">4</span>   <span class="o">-</span><span class="mf">1.353e+01</span>   <span class="o">-</span><span class="mf">4.576e+01</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.6240</span>   <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">5</span>   <span class="o">-</span><span class="mf">1.668e+01</span>   <span class="o">-</span><span class="mf">3.615e+01</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.4594</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span>
 <span class="mi">6</span>   <span class="o">-</span><span class="mf">1.805e+01</span>   <span class="o">-</span><span class="mf">3.053e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.4915</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">7</span>   <span class="o">-</span><span class="mf">1.894e+01</span>   <span class="o">-</span><span class="mf">2.786e+01</span>   <span class="o">+</span><span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.3545</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span>
 <span class="mi">8</span>   <span class="o">-</span><span class="mf">1.954e+01</span>   <span class="o">-</span><span class="mf">2.486e+01</span>   <span class="o">+</span><span class="mi">6</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.7330</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span>
 <span class="mi">9</span>   <span class="o">-</span><span class="mf">2.008e+01</span>   <span class="o">-</span><span class="mf">2.274e+01</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.8195</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
<span class="mi">10</span>   <span class="o">-</span><span class="mf">2.074e+01</span>   <span class="o">-</span><span class="mf">2.178e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.7700</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="mi">11</span>   <span class="o">-</span><span class="mf">2.098e+01</span>   <span class="o">-</span><span class="mf">2.153e+01</span>   <span class="o">+</span><span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.7530</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">12</span>   <span class="o">-</span><span class="mf">2.121e+01</span>   <span class="o">-</span><span class="mf">2.126e+01</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.9767</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">13</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mf">0.9768</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
<span class="mi">14</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mf">0.9899</span>   <span class="mi">3</span> <span class="mi">1</span> <span class="mi">1</span>
<span class="mi">15</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">-</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">12</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mf">0.9899</span>   <span class="mi">3</span> <span class="mi">1</span> <span class="mi">1</span>

<span class="n">OPTIMAL</span> <span class="p">(</span><span class="n">within</span> <span class="n">feastol</span><span class="o">=</span><span class="mf">2.5e-10</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">6.3e-09</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">1.3e-07</span><span class="p">)</span><span class="o">.</span>
<span class="n">Runtime</span><span class="p">:</span> <span class="mf">0.012406</span> <span class="n">seconds</span><span class="o">.</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">)),)</span>
<span class="nb">print</span> <span class="s2">&quot;The smuggler&#39;s chance of evasion is </span><span class="si">%.2f</span><span class="s2"> times smaller than with the uniform resource allocation.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 5.963000e-10.</span>
<span class="n">The</span> <span class="n">smuggler</span><span class="s1">&#39;s chance of evasion is 14948695.12 times smaller than with the uniform resource allocation.</span>
</pre></div>
</div>
<p>Here we plot the resulting edge evasion probabilities from the optimal
allocation.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span> <span class="n">at</span> <span class="mh">0x10e9b5810</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x10e9b5c10</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_15_1.png"><img alt="../../_images/interdiction_15_1.png" src="../../_images/interdiction_15_1.png" style="width: 463px; height: 376px;" /></a>
<p>We can now solve the smuggler’s problem with these optimal resource
allocations, but we won’t recover a Boolean solution for
<span class="math">\(x^{\star}\)</span> because the optimal path is not unique. Note, however,
that the optimal evasion probability is the same.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cvx</span><span class="o">.</span><span class="n">Maximize</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">c</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ECOS</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">A</span><span class="o">.</span> <span class="n">Domahidi</span><span class="p">,</span> <span class="n">Automatic</span> <span class="n">Control</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">ETH</span> <span class="n">Zurich</span><span class="p">,</span> <span class="mi">2012</span><span class="o">-</span><span class="mf">2014.</span>

<span class="n">It</span>     <span class="n">pcost</span>         <span class="n">dcost</span>      <span class="n">gap</span>     <span class="n">pres</span>    <span class="n">dres</span>     <span class="n">k</span><span class="o">/</span><span class="n">t</span>     <span class="n">mu</span>      <span class="n">step</span>     <span class="n">IR</span>
 <span class="mi">0</span>   <span class="o">+</span><span class="mf">9.649e+01</span>   <span class="o">-</span><span class="mf">1.080e+03</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>    <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span>
 <span class="mi">1</span>   <span class="o">+</span><span class="mf">5.962e+01</span>   <span class="o">-</span><span class="mf">4.143e+02</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.6885</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">2</span>   <span class="o">+</span><span class="mf">2.876e+01</span>   <span class="o">-</span><span class="mf">6.403e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.8229</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">3</span>   <span class="o">+</span><span class="mf">2.198e+01</span>   <span class="o">+</span><span class="mf">3.683e+00</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.8212</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">4</span>   <span class="o">+</span><span class="mf">2.128e+01</span>   <span class="o">+</span><span class="mf">2.055e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.9712</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">5</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mf">2.123e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.9899</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">6</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mf">0.9872</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">7</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mf">0.8558</span>   <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
 <span class="mi">8</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">13</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mf">0.8147</span>   <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
 <span class="mi">9</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mf">2.124e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mf">0.8312</span>   <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>

<span class="n">OPTIMAL</span> <span class="p">(</span><span class="n">within</span> <span class="n">feastol</span><span class="o">=</span><span class="mf">8.6e-11</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">4.6e-08</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">9.9e-07</span><span class="p">)</span><span class="o">.</span>
<span class="n">Runtime</span><span class="p">:</span> <span class="mf">0.004146</span> <span class="n">seconds</span><span class="o">.</span>

<span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 5.962999e-10.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_17_1.png"><img alt="../../_images/interdiction_17_1.png" src="../../_images/interdiction_17_1.png" style="width: 391px; height: 264px;" /></a>
<p>We use
<a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a>
again to recover an optimal path for the smuggler in the case that the
path is not unique and plot it below. We again check that the detection
probability is what we predicted previously.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 5.963000e-10.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_19_1.png"><img alt="../../_images/interdiction_19_1.png" src="../../_images/interdiction_19_1.png" style="width: 463px; height: 376px;" /></a>
</div>
<div class="section" id="guard-placement-example">
<h1>Guard placement example<a class="headerlink" href="#guard-placement-example" title="Permalink to this headline">¶</a></h1>
<p>We can now go through a more advanced example.</p>
<p>In the previous example, security had direct control over the evasion
probability on each edge. In this section, we’ll consider an example
where security can only control the edge probabilities through the
placement of guards, each of whom will effect edges which are close to
them.</p>
<p>In the last example, the security team put a lot of effort on edges near
the source and destination nodes. We’ll make the team’s job a bit harder
by allowing the smuggler’s path to start at any node on the left side of
the graph, and end at any node on the right. This will force the team to
allocate resources more evenly over the graph.</p>
<p>To make things even more interesting, we’ll add ‘buildings’ in the
region covered by the graph. The smuggler and security will have to work
around the buildings. That is, no node is located inside a building, no
edge crosses through a building, and guards can’t see through building
walls, restricting their line-of-sight and effect on nearby edges.</p>
<div class="section" id="multiple-sources-and-destinations">
<h2>Multiple sources and destinations<a class="headerlink" href="#multiple-sources-and-destinations" title="Permalink to this headline">¶</a></h2>
<p>To allow for multiple source and destination nodes without changing the
convex formulation, we’ll add a dummy source node and a dummy sink node.
The source node will have edges going to each node in the graph on the
left hand side. The sink node will have edges going to each node on the
right. We’ll ensure that these dummy edges always have evasion
probability 1. The plot below demonstrates the idea. We won’t plot the
dummy nodes or edges, but we will highlight the ‘new’ source and sink
nodes with light green and red as before.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="c1"># show dummy source and destination node</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-.</span><span class="mi">6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">,</span><span class="o">-.</span><span class="mi">05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">]);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_21_0.png"><img alt="../../_images/interdiction_21_0.png" src="../../_images/interdiction_21_0.png" style="width: 485px; height: 364px;" /></a>
</div>
<div class="section" id="guards">
<h2>Guards<a class="headerlink" href="#guards" title="Permalink to this headline">¶</a></h2>
<p>The security team will select a subset of guards to place in the graph.
Each guard will have a profile, which gives his effect on the edge
evasion probabilities. The guard’s effect will be a function of his
distance to the center of each edge. In principle, guards could be
placed anywhere in the region occupied by the graph, but we’ll only
consider guards placed on node positions to make them easy to visualize.</p>
<p>An example of a few guards and the resulting evasion probabilities is
shown below.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_23_0.png"><img alt="../../_images/interdiction_23_0.png" src="../../_images/interdiction_23_0.png" style="width: 463px; height: 376px;" /></a>
</div>
<div class="section" id="buildings">
<h2>Buildings<a class="headerlink" href="#buildings" title="Permalink to this headline">¶</a></h2>
<p>We’ll also add buildings, which will modify the graph topology and also
restrict the view of the guards.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">buildings</span> <span class="o">=</span> <span class="p">[(</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">35</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">55</span><span class="p">,</span><span class="o">.</span><span class="mi">55</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">35</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">65</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">.</span><span class="mi">11</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_25_0.png"><img alt="../../_images/interdiction_25_0.png" src="../../_images/interdiction_25_0.png" style="width: 463px; height: 376px;" /></a>
</div>
</div>
<div class="section" id="example-to-solve">
<h1>Example to solve<a class="headerlink" href="#example-to-solve" title="Permalink to this headline">¶</a></h1>
<p>We’ll solve a larger example with buildings, guards, and multiple source
and destination nodes. We’ll consider a guard at every interior node of
the graph, and try to find a limited number, say 10, to secure the graph
as well as possible.</p>
</div>
<div class="section" id="id1">
<h1>TODO<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>optimization formulation</li>
<li>this one turns out to be a ‘true’ integer program, unlike the last</li>
<li>use iterative reweighting to get boolean solution</li>
<li>use relaxation to give bounds on distance to true optimal</li>
</ul>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">buildings</span> <span class="o">=</span> <span class="p">[(</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">35</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">55</span><span class="p">,</span><span class="o">.</span><span class="mi">55</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">35</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
             <span class="p">(</span><span class="o">.</span><span class="mi">65</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">.</span><span class="mi">11</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_28_0.png"><img alt="../../_images/interdiction_28_0.png" src="../../_images/interdiction_28_0.png" style="width: 603px; height: 488px;" /></a>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">incidence_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">oriented</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>
<span class="n">numGuards</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numGuards</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">numGuards</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">nu</span> <span class="o">&gt;=</span> <span class="n">edgeVals</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">cvx</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cvx</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cvx</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">w</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eps</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ECOS</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">A</span><span class="o">.</span> <span class="n">Domahidi</span><span class="p">,</span> <span class="n">Automatic</span> <span class="n">Control</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">ETH</span> <span class="n">Zurich</span><span class="p">,</span> <span class="mi">2012</span><span class="o">-</span><span class="mf">2014.</span>

<span class="n">It</span>     <span class="n">pcost</span>         <span class="n">dcost</span>      <span class="n">gap</span>     <span class="n">pres</span>    <span class="n">dres</span>     <span class="n">k</span><span class="o">/</span><span class="n">t</span>     <span class="n">mu</span>      <span class="n">step</span>     <span class="n">IR</span>
 <span class="mi">0</span>   <span class="o">+</span><span class="mf">1.000e+01</span>   <span class="o">-</span><span class="mf">1.967e+02</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>    <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span>
 <span class="mi">1</span>   <span class="o">+</span><span class="mf">1.001e+01</span>   <span class="o">-</span><span class="mf">2.165e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.8149</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">2</span>   <span class="o">+</span><span class="mf">1.000e+01</span>   <span class="o">+</span><span class="mf">7.747e+00</span>   <span class="o">+</span><span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.9210</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">3</span>   <span class="o">+</span><span class="mf">9.969e+00</span>   <span class="o">+</span><span class="mf">9.677e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.8876</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">4</span>   <span class="o">+</span><span class="mf">9.901e+00</span>   <span class="o">+</span><span class="mf">9.801e+00</span>   <span class="o">+</span><span class="mi">4</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.7160</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">5</span>   <span class="o">+</span><span class="mf">9.882e+00</span>   <span class="o">+</span><span class="mf">9.837e+00</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.6887</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">6</span>   <span class="o">+</span><span class="mf">9.873e+00</span>   <span class="o">+</span><span class="mf">9.843e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.6929</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">7</span>   <span class="o">+</span><span class="mf">9.873e+00</span>   <span class="o">+</span><span class="mf">9.844e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.1589</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">8</span>   <span class="o">+</span><span class="mf">9.872e+00</span>   <span class="o">+</span><span class="mf">9.845e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.3356</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">9</span>   <span class="o">+</span><span class="mf">9.867e+00</span>   <span class="o">+</span><span class="mf">9.850e+00</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.3922</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">10</span>   <span class="o">+</span><span class="mf">9.865e+00</span>   <span class="o">+</span><span class="mf">9.853e+00</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.9899</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">11</span>   <span class="o">+</span><span class="mf">9.862e+00</span>   <span class="o">+</span><span class="mf">9.856e+00</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.5289</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">12</span>   <span class="o">+</span><span class="mf">9.860e+00</span>   <span class="o">+</span><span class="mf">9.857e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.9518</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">13</span>   <span class="o">+</span><span class="mf">9.859e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.5953</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">14</span>   <span class="o">+</span><span class="mf">9.859e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.4644</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">15</span>   <span class="o">+</span><span class="mf">9.859e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.7346</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">16</span>   <span class="o">+</span><span class="mf">9.859e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mf">0.6513</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">17</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mf">0.7849</span>   <span class="mi">3</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">18</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mf">0.8749</span>   <span class="mi">3</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">19</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mf">0.9861</span>   <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
<span class="mi">20</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mf">9.858e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">12</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mf">0.9889</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">1</span>

<span class="n">OPTIMAL</span> <span class="p">(</span><span class="n">within</span> <span class="n">feastol</span><span class="o">=</span><span class="mf">1.8e-10</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">1.0e-08</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">9.8e-08</span><span class="p">)</span><span class="o">.</span>
<span class="n">Runtime</span><span class="p">:</span> <span class="mf">0.161358</span> <span class="n">seconds</span><span class="o">.</span>


<span class="n">ECOS</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">A</span><span class="o">.</span> <span class="n">Domahidi</span><span class="p">,</span> <span class="n">Automatic</span> <span class="n">Control</span> <span class="n">Laboratory</span><span class="p">,</span> <span class="n">ETH</span> <span class="n">Zurich</span><span class="p">,</span> <span class="mi">2012</span><span class="o">-</span><span class="mf">2014.</span>

<span class="n">It</span>     <span class="n">pcost</span>         <span class="n">dcost</span>      <span class="n">gap</span>     <span class="n">pres</span>    <span class="n">dres</span>     <span class="n">k</span><span class="o">/</span><span class="n">t</span>     <span class="n">mu</span>      <span class="n">step</span>     <span class="n">IR</span>
 <span class="mi">0</span>   <span class="o">+</span><span class="mf">9.846e+01</span>   <span class="o">-</span><span class="mf">9.459e+02</span>   <span class="o">+</span><span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">7</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>    <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="mi">1</span> <span class="mi">1</span> <span class="o">-</span>
 <span class="mi">1</span>   <span class="o">-</span><span class="mf">6.134e+01</span>   <span class="o">-</span><span class="mf">3.585e+02</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mf">0.7426</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">2</span>   <span class="o">-</span><span class="mf">3.992e+01</span>   <span class="o">-</span><span class="mf">2.121e+02</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mf">0.3914</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">3</span>   <span class="o">-</span><span class="mf">1.953e+01</span>   <span class="o">-</span><span class="mf">1.187e+02</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mf">0.4868</span>   <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">4</span>   <span class="o">-</span><span class="mf">4.987e+00</span>   <span class="o">-</span><span class="mf">5.829e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.5444</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">5</span>   <span class="o">+</span><span class="mf">5.937e+00</span>   <span class="o">-</span><span class="mf">2.055e+01</span>   <span class="o">+</span><span class="mi">6</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.6100</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">6</span>   <span class="o">+</span><span class="mf">9.139e+00</span>   <span class="o">-</span><span class="mf">3.756e+00</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.6404</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
 <span class="mi">7</span>   <span class="o">+</span><span class="mf">1.068e+01</span>   <span class="o">+</span><span class="mf">4.133e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mf">0.5708</span>   <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span>
 <span class="mi">8</span>   <span class="o">+</span><span class="mf">1.124e+01</span>   <span class="o">+</span><span class="mf">6.854e+00</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.4755</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
 <span class="mi">9</span>   <span class="o">+</span><span class="mf">1.219e+01</span>   <span class="o">+</span><span class="mf">1.092e+01</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.8123</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">10</span>   <span class="o">+</span><span class="mf">1.231e+01</span>   <span class="o">+</span><span class="mf">1.134e+01</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mf">0.5214</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">11</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.203e+01</span>   <span class="o">+</span><span class="mi">6</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.8063</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">12</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.219e+01</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.6807</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">13</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.223e+01</span>   <span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>   <span class="mf">0.5780</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">14</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.226e+01</span>   <span class="o">+</span><span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.6916</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">15</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.227e+01</span>   <span class="o">+</span><span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mf">0.8870</span>   <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">16</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>   <span class="mf">0.9454</span>   <span class="mi">3</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="mi">17</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mf">0.9800</span>   <span class="mi">3</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">18</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>   <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mf">0.9894</span>   <span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span>
<span class="mi">19</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mf">1.228e+01</span>   <span class="o">+</span><span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>   <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">09</span>   <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">11</span>   <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span>   <span class="mf">0.9134</span>   <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>

<span class="n">OPTIMAL</span> <span class="p">(</span><span class="n">within</span> <span class="n">feastol</span><span class="o">=</span><span class="mf">1.7e-09</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">5.9e-08</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">7.2e-07</span><span class="p">)</span><span class="o">.</span>
<span class="n">Runtime</span><span class="p">:</span> <span class="mf">0.159205</span> <span class="n">seconds</span><span class="o">.</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x10eb95dd0</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_30_1.png"><img alt="../../_images/interdiction_30_1.png" src="../../_images/interdiction_30_1.png" style="width: 402px; height: 264px;" /></a>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">guards</span> <span class="o">=</span> <span class="p">[</span><span class="n">guardIdxs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">))</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guards</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_31_0.png"><img alt="../../_images/interdiction_31_0.png" src="../../_images/interdiction_31_0.png" style="width: 463px; height: 376px;" /></a>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">)</span>
<span class="n">path_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">1</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path_inds</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guards</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 4.944881e-06.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_32_1.png"><img alt="../../_images/interdiction_32_1.png" src="../../_images/interdiction_32_1.png" style="width: 463px; height: 376px;" /></a>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CVXPY</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=cvxgrp&repo=cvxpy&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a href="https://travis-ci.org/cvxgrp/cvxpy">
    <img
        alt="https://secure.travis-ci.org/cvxgrp/cvxpy.svg?branch=master"
        src="https://secure.travis-ci.org/cvxgrp/cvxpy.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Install Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/cvxpy.html">API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../citing/index.html">Citing CVXPY</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../updates/index.html">What’s New in CVXPY 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../related_projects/index.html">Related Projects</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Steven Diamond, Eric Chu, Akshay Agrawal, Stephen Boyd.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/examples/applications/interdiction.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/cvxgrp/cvxpy" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-50248335-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>